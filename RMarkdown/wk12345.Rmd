---
title: ''
author: "Yun Zhao"
date: "12/8/2021"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
### Introduction
Greater importance of research question; relate to task. 
Based on exploration...

...my research question is....

  factors affecting, contributing, leading to, 


mention null and models.



### All Packages
```{r}
#Load
library(stringr)
library(utils)
library(readr)
library(here)
library(googledrive)
library(usethis)

#Wrangle
library(janitor)
library(tidyverse) #includes dplyr
library(car)
library(crosstalk)
library(RSQLite)
library(dplyr)

#Vector
library(rgdal)
library(sf)
library(sp)
library(fs)
library(rgeos)
library(geojson)
library(geojsonio)

#Raster
library(raster)
library(fpc)
library(rasterVis)
library(terra)
library(RStoolbox)
library(htmlwidgets)

#Graphs
library(plotly) # graphs
library(ggplot2)
library(GGally)
library(shiny)
library(shinyjs) # tmaptools::palette_explorer()

#Maps
library(maptools)
library(tmap)
library(tmaptools)
library(GISTools)
library(OpenStreetMap)
library(RColorBrewer)
library(rgeos)
library(rmapshaper)
library(leafpop)
library(leaflet)
library(mapview)
library(biscale)
library(cowplot)
library(sysfonts)
library(extrafont) 
library(showtext) # more fonts

#Stats
library(corrr)
library(car)
library(rstatix)
library(spatstat)
library(fpc)
library(dbscan)
library(broom) # glance(), inside tidymodels package.
library(tidypredict) # tidypredict_to_column()
library(spatialreg) # spatial lag model
library(spdep) #Lagrange Multiplier test
library(spgwr) #Spatial Non-stationarity and Geographically Weighted Regression Models (GWR)
```


Sources:
https://geocompr.robinlovelace.net/spatial-class.html Ch. 2.2, 2.3
https://swcarpentry.github.io/r-novice-gapminder/14-tidyr/
https://fromthebottomoftheheap.net/2019/10/25/pivoting-tidily/

### Loading Data
read.csv
read_csv
download.file
util for tar unzip
latin encoding


### Exploring Data
what should summary statistics include?

variable
head()
tail()
summarise()
nrow()
ncol()
view()

### Wrangling Data
what is munging?

Clip to Study Area

as_tibble()%>%
as.numeric()%>%


### Objects
```{r}
# sf to sp
as(., 'Spatial') 

# for ppp objects, spatstat
window <- as.owin(Harrow)
plot(window)

# sp to ppp
ppp(x=var@coords[,1],
    y=var@coords[,2],
    window=window)

```




Discussion points: tidy data
```{r}
clean_names()
# do this because
distinct()

select()  # subset column
filter(col=) # subset row
across()

group_by() # labels rows (all rows not a subset) but does not modify
summarise() # calculates values of groups, often mutate follows
summarise_all()
mutate() # create/rename/edit column

pivot_longer()
# need for faceted maps

sf[sf,]
#https://geocompr.robinlovelace.net/spatial-operations.html?q=subset#spatial-raster-subsetting

```

### Graphing Data
plot()
ggplot()
tmaptools::palette_explorer()



### Mapping Data
st_crs
crs
st_geometry

British National Grid 27700
proj 4: 

EPSG 4236


UTM stuff
https://epsg.io/32618
http://geokov.com/education/utm.aspx
```{r}
qtm() # quick tmap
tmap # https://geocompr.robinlovelace.net/adv-map.html#tmap-basics
```



### Analyze / Statistics
Spatial  Analysis
Point Pattern Analysis
  Quadrat Count
  Ripley's K
  DBSCAN
Spatial Autocorrelation
  Spatial Weights Matrix
  Global Indices
  Local Indices + Maps

https://mgimond.github.io/Spatial/chp11_0.html


# Questions
tibble vs. dataframe
how to choose eps, k
ripley's k have hypoth test?
it's okay to use qgis and explain
read.csv vs. read_csv

brighton_pubs_pts <- brighton_pubs_sp%>%
  coordinates(.)%>%
  as.data.frame()
  
chulls <- BluePlaquesSubPoints %>%
group_by(dbcluster) %>%  # group by which cluster each row is in
dplyr::mutate(hull = 1:n(),
              hull = factor(hull, chull(coords.x1, coords.x2)))%>%

```{r}
1:n()
```

              
              
arrange(hull)
#local projected crs British National Grid (ESPG: 27700)
?st_as_sfc
# ?class sf, sfc or sfg
?st_within
st_crs(brighton)$proj4string
st_crs(pubspts)$proj4string


gitignore, renv, committing

preference to unload from a zip?

"Here, adding ..density.. means that the histogram is a density plot, this plots the chance that any value in the data is equal to that value."

knee or kipling's to find eps?
why do localmoran count or density?
how to interpret hulls?

Correlation_all<- LonWardProfiles %>%
  st_drop_geometry()%>%
  dplyr::select(position)%>%
  correlate()

##First get the bbox in lat long for Harrow. ?????why
HarrowWGSbb <- Harrow %>%
  st_transform(., 4326)%>%   
  st_bbox()
  
  Correlation_all<- LonWardProfiles %>%
  st_drop_geometry()#%>%
  dplyr::select(position)%>%
  correlate()
  
  Warning in logLik.sarlm(object) : install the spatialreg package
Warning in residuals.sarlm(object) : install the spatialreg package
Warning in coef.sarlm(s) : install the spatialreg package
Error in if (!is.null(new_names) && length(new_names) != ncol(x)) { : 
  missing value where TRUE/FALSE needed
